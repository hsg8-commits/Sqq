# ููุงุญุธุงุช ุงููุดุฑ - Deployment Notes

## โ ุงููุดุงูู ุงูุชู ุชู ุญููุง

### 1. ูุดููุฉ AdminLog validation error
**ุงููุดููุฉ**: ุธููุฑ ุฎุทุฃ 500 ุนูุฏ ูุญุงููุฉ ุชุณุฌูู ุงูุฏุฎูู ุจุฏูุงู ูู ุฑุณุงูุฉ "ุงุณู ุงููุณุชุฎุฏู ุฃู ูููุฉ ุงููุฑูุฑ ุบูุฑ ุตุญูุญุฉ".

**ุงูุณุจุจ**:
- ุนูุฏ ูุญุงููุฉ ุชุณุฌูู ุฏุฎูู ุจูุณุชุฎุฏู ุบูุฑ ููุฌูุฏุ ูุชู ุชุณุฌูู ุงูุญุฏุซ ูู AdminLog
- ูุงู ุญูู `adminId` ูู schema ุงูู AdminLog ูุทููุจุงู (`required: true`)
- ุนูุฏูุง ูููู ุงููุณุชุฎุฏู ุบูุฑ ููุฌูุฏุ ูุชู ุชูุฑูุฑ `null` ูู `adminId`
- ูุฐุง ูุณุจุจ ุฎุทุฃ validation ููุคุฏู ุฅูู 500 Internal Server Error

**ุงูุญู**:
```javascript
// ูู lib/models/AdminLog.js
adminId: {
  type: mongoose.Schema.Types.ObjectId,
  ref: 'Admin',
  required: false, // ุฌุนู ุงูุญูู ุงุฎุชูุงุฑูุงู
}
```

### 2. ูุดููุฉ ุฅุนุงุฏุฉ ุงูุชุญููู ุงููุงููุงุฆูุฉ (Infinite Reload)
**ุงููุดููุฉ**: ูุงูุช ุงูุตูุญุฉ ุชูุนูุฏ ุชุญููู ููุณูุง ุจุงุณุชูุฑุงุฑ ุนูุฏ ูุชุญ ุงูุฑุงุจุท ุงูุฃุณุงุณู.

**ุงูุณุจุจ**: 
- ุนูุฏ ูุญุงููุฉ ุงูุชุญูู ูู ุงููุณุชุฎุฏู ุงููุณุฌู ุฏุฎููู ุนุจุฑ `/api/auth/profile`
- ูุงู ุงูู API ูุฑุฌุน ุฎุทุฃ 401 (ุบูุฑ ูุตุฑุญ)
- ุงูู axios interceptor ูุงู ูููู ุจุฅุนุงุฏุฉ ุชูุฌูู ุงููุณุชุฎุฏู ุฅูู `/`
- ูุฐุง ูุณุจุจ ุญููุฉ ูุง ููุงุฆูุฉ: ุชุญููู ุงูุตูุญุฉ โ ุทูุจ profile โ ุฎุทุฃ 401 โ ุฅุนุงุฏุฉ ุชูุฌูู โ ุชุญููู ุงูุตูุญุฉ...

**ุงูุญู**:
```typescript
// ูู lib/axios.ts
// ูุง ุชูู ุจุฅุนุงุฏุฉ ุงูุชูุฌูู ุนูุฏ ูุดู ุงูุชุญูู ูู profile
if (error.response?.status === 401 && !error.config.url?.includes('/api/auth/profile')) {
  // ููุท ุฃุนุฏ ุงูุชูุฌูู ููุทูุจุงุช ุงูุฃุฎุฑู
}
```

### 2. ูุดููุฉ Network Error
**ุงููุดููุฉ**: ุธููุฑ "Network Error" ุนูุฏ ูุญุงููุฉ ุชุณุฌูู ุงูุฏุฎูู ูู ุฑูุงุจุท Vercel ุงููุฎุชููุฉ.

**ุงูุณุจุจ**:
- ูุงู ุงูู baseURL ูู axios ูุถุจูุท ุนูู ุฑุงุจุท ุซุงุจุช: `https://sqq-virid.vercel.app`
- ุนูุฏ ุงูุฏุฎูู ูู ุฑุงุจุท preview ูุฎุชูู (ูุซู: `sqq-18y4djrf7-sjgdsofts-projects.vercel.app`)
- ูุงูุช ุงูุทูุจุงุช ุชุฐูุจ ููุฏูููู ุงูุฎุทุฃ ููุง ูุณุจุจ CORS errors

**ุงูุญู**:
```typescript
// ูู lib/axios.ts
const axiosInstance = axios.create({
  // ุงุณุชุฎุฏุงู ุงูุฏูููู ุงูุญุงูู ุฏููุงููููุงู
  baseURL: typeof window !== 'undefined' ? window.location.origin : '',
  withCredentials: true,
});
```

### 3. ูุดููุฉ Database Connection ุฃุซูุงุก ุงูุจูุงุก
**ุงููุดููุฉ**: ูุดู ุงูุจูุงุก ุจุณุจุจ ุนุฏู ูุฌูุฏ MONGODB_URI.

**ุงูุญู**:
```javascript
// ูู lib/db.js
// ูุง ุชุฑูู ุฎุทุฃ ุฃุซูุงุก ุงูุจูุงุกุ ููุท ุชุญุฐูุฑ
if (!MONGODB_URI && typeof window === 'undefined' && process.env.NODE_ENV === 'production') {
  console.warn('โ๏ธ MONGODB_URI is not defined');
}
```

## ๐ง ุฅุนุฏุงุฏุงุช Vercel ุงููุทููุจุฉ

ุชุฃูุฏ ูู ุฅุถุงูุฉ ุงููุชุบูุฑุงุช ุงูุจูุฆูุฉ ุงูุชุงููุฉ ูู ุฅุนุฏุงุฏุงุช Vercel:

```env
MONGODB_URI=mongodb+srv://username:password@cluster.mongodb.net/database
JWT_SECRET=your-very-secret-jwt-key-here
NODE_ENV=production
```

### ููููุฉ ุฅุถุงูุฉ ุงููุชุบูุฑุงุช ูู Vercel:
1. ุงุฐูุจ ุฅูู dashboard.vercel.com
2. ุงุฎุชุฑ ุงููุดุฑูุน
3. ุงุฐูุจ ุฅูู Settings โ Environment Variables
4. ุฃุถู ูู ูุชุบูุฑ ุนูู ุญุฏุฉ
5. ุชุฃูุฏ ูู ุชุญุฏูุฏ "Production", "Preview", ู "Development"

## ๐ ุงูุขู ุงูุชุทุจูู ูุนูู ุนูู:

- โ ุงูุฑุงุจุท ุงูุฃุณุงุณู: https://sqq-virid.vercel.app
- โ ุฑูุงุจุท Preview: https://sqq-*.vercel.app
- โ ุงูุฑูุงุจุท ุงูุฏุงุฎููุฉ: https://sqq-*-sjgdsofts-projects.vercel.app

## ๐ ุจูุงูุงุช ุงูุฏุฎูู ุงูุงูุชุฑุงุถูุฉ

### ุงููุดุฑู ุงูุนุงู (Super Admin)
- **ุงุณู ุงููุณุชุฎุฏู**: `superadmin`
- **ูููุฉ ุงููุฑูุฑ**: `admin123456`

### ุงููุดุฑู ุงูุนุงุฏู (Moderator)
- **ุงุณู ุงููุณุชุฎุฏู**: `moderator`
- **ูููุฉ ุงููุฑูุฑ**: `moderator123456`

โ๏ธ **ููู ุฌุฏุงู**: ูู ุจุชุบููุฑ ูููุงุช ุงููุฑูุฑ ููุฑ ุชุณุฌูู ุงูุฏุฎูู ุงูุฃูู!

## ๐ ููุงุญุธุงุช ุฅุถุงููุฉ

### โ๏ธ ููู ุฌุฏุงู: ุฅูุดุงุก ุญุณุงุจุงุช ุงููุดุฑููู

**ูุจู ุฃู ุชุชููู ูู ุชุณุฌูู ุงูุฏุฎูู**ุ ูุฌุจ ุฅูุดุงุก ุญุณุงุจ ุงููุดุฑู ุงูุฃุณุงุณู ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช:

#### ุงูุทุฑููุฉ 1: ุชุดุบูู ุงูุณูุฑูุจุช ูุญููุงู (ููุตู ุจู)
```bash
# 1. ุงูุณุฎ ุงููุดุฑูุน ุนูู ุฌูุงุฒู
git clone [repository-url]

# 2. ุซุจุช ุงูููุชุจุงุช
npm install

# 3. ุฃูุดุฆ ููู .env ุจููุณ ุจูุงูุงุช Vercel
# ุชุฃูุฏ ูู ุฃู MONGODB_URI ูู ููุณู ุงููุณุชุฎุฏู ูู Vercel

# 4. ุดุบู ุงูุณูุฑูุจุช
node scripts/init-admin.js
```

#### ุงูุทุฑููุฉ 2: ุฅูุดุงุก ุงูุญุณุงุจ ูุฏููุงู ูู MongoDB
ุฅุฐุง ูู ุชุชููู ูู ุชุดุบูู ุงูุณูุฑูุจุชุ ููููู ุฅูุดุงุก ุงููุดุฑู ูุฏููุงู:

1. ุงุฐูุจ ุฅูู MongoDB Atlas/Compass
2. ุงูุชุญ ูุงุนุฏุฉ ุจูุงูุงุชู
3. ุฃูุดุฆ collection ุฌุฏูุฏุฉ ุงุณููุง `admins`
4. ุฃุถู document ุจูุฐุง ุงูุดูู:

```javascript
{
  username: "superadmin",
  email: "admin@telegram.com",
  password: "$2a$12$YOUR_HASHED_PASSWORD_HERE", // ูููุฉ ุงููุฑูุฑ ูุดูุฑุฉ ุจู bcrypt
  role: "superadmin",
  permissions: ["ALL"],
  isActive: true,
  loginAttempts: 0,
  twoFactorEnabled: false,
  createdAt: new Date(),
  updatedAt: new Date()
}
```

**ูุชุดููุฑ ูููุฉ ุงููุฑูุฑ**ุ ุงุณุชุฎุฏู ุฃู ุฃุฏุงุฉ bcrypt online ูุน:
- ูููุฉ ุงููุฑูุฑ: `admin123456`
- Salt rounds: `12`

#### ุงูุทุฑููุฉ 3: ุงุณุชุฎุฏุงู API endpoint ุงููุคูุช (ุงูุฃุณูู) โญ
ูููุง ุจุฅูุดุงุก API endpoint ูุคูุช ูุชุณููู ุฅูุดุงุก ุงููุดุฑู ุงูุฃูู:

**ุฎุทูุงุช ุงูุงุณุชุฎุฏุงู:**

1. **ุงูุชุญ ุงููุชุตูุญ** ูุงุฐูุจ ุฅูู:
   ```
   https://sqq-virid.vercel.app/api/setup/init-admin
   ```
   ูุฐุง ุณูุนุฑุถ ูู ุชุนูููุงุช ุงูุงุณุชุฎุฏุงู.

2. **ุงุณุชุฎุฏู ุฃุฏุงุฉ ูุซู Postman ุฃู curl** ูุฅุฑุณุงู ุทูุจ POST:
   
   **ุจุงุณุชุฎุฏุงู curl:**
   ```bash
   curl -X POST https://sqq-virid.vercel.app/api/setup/init-admin \
     -H "Content-Type: application/json" \
     -d '{}'
   ```
   
   **ุฃู ูุน ุจูุงูุงุช ูุฎุตุตุฉ:**
   ```bash
   curl -X POST https://sqq-virid.vercel.app/api/setup/init-admin \
     -H "Content-Type: application/json" \
     -d '{
       "username": "superadmin",
       "email": "admin@telegram.com",
       "password": "admin123456"
     }'
   ```

3. **ูู ุงููุชุตูุญ (ุทุฑููุฉ ุจุฏููุฉ):**
   - ุงูุชุญ Developer Console (F12)
   - ุงุฐูุจ ุฅูู Console tab
   - ุงูุตู ูุฐุง ุงูููุฏ:
   ```javascript
   fetch('/api/setup/init-admin', {
     method: 'POST',
     headers: { 'Content-Type': 'application/json' },
     body: JSON.stringify({})
   })
   .then(r => r.json())
   .then(data => console.log(data));
   ```

4. **โ๏ธ ููู ุฌุฏุงู**: ุจุนุฏ ุฅูุดุงุก ุงููุดุฑู ุจูุฌุงุญุ **ุงุญุฐู ุงูููู ุงูุชุงูู ููุฑุงู**:
   ```
   app/api/setup/init-admin/route.ts
   ```
   ูุฐุง ุถุฑูุฑู ูุฃุณุจุงุจ ุฃูููุฉ!

---

### ูู ุญุงูุฉ ุงุณุชูุฑุงุฑ ูุดููุฉ Network Error:
- ุงูุณุญ cookies ุงููุชุตูุญ
- ุงูุณุญ cache ุงููุชุตูุญ
- ุฌุฑุจ ูู ูุถุน ุงูุชุตูุญ ุงูุฎุงุต (Incognito)

### ููุชุญูู ูู logs:
- ุงุฐูุจ ุฅูู Vercel Dashboard
- ุงุฎุชุฑ ุงููุดุฑูุน
- ุงุฐูุจ ุฅูู "Deployments"
- ุงุถุบุท ุนูู ุขุฎุฑ deployment
- ุงุฐูุจ ุฅูู "Runtime Logs" ูุฑุคูุฉ ุงูุฃุฎุทุงุก

## ๐ฏ ุงูุชุญุณููุงุช ุงููุทุจูุฉ

- โ ูุนุงูุฌุฉ ุฃุฎุทุงุก ุงููุตุงุฏูุฉ ุจุดูู ุตุญูุญ
- โ ุฏุนู ุฌููุน ุฑูุงุจุท Vercel ุชููุงุฆูุงู
- โ ููุน ุงูู infinite reload loops
- โ ุชุญุณูู ุชุฌุฑุจุฉ ุงููุณุชุฎุฏู ุนูุฏ ุงูุฃุฎุทุงุก
- โ ุฅุถุงูุฉ ุฑุณุงุฆู ุฎุทุฃ ูุงุถุญุฉ ูุจุงูุนุฑุจูุฉ
- โ ุชุญุณูู ุฃุฏุงุก ุงูุจูุงุก (Build)

## ๐ ูู ุญุงูุฉ ูุฌูุฏ ูุดุงูู

ุฅุฐุง ูุงุฌูุช ุฃู ูุดุงูู ุจุนุฏ ุงููุดุฑ:

1. ุชุญูู ูู Environment Variables ูู Vercel
2. ุชุญูู ูู Runtime Logs
3. ุชุฃูุฏ ูู ุฃู ูุงุนุฏุฉ ุงูุจูุงูุงุช ูุชุตูุฉ ูุชุนูู
4. ุชุฃูุฏ ูู ุชุดุบูู init script ูุฅูุดุงุก ุงููุดุฑููู

---

**ุขุฎุฑ ุชุญุฏูุซ**: 2024-10-31
**ุงููุณุฎุฉ**: 1.0.2

---

## ๐ ุงุณุชูุดุงู ุงูุฃุฎุทุงุก ุงูุดุงุฆุนุฉ

### "ุงุณู ุงููุณุชุฎุฏู ุฃู ูููุฉ ุงููุฑูุฑ ุบูุฑ ุตุญูุญุฉ"
**ุงูุฃุณุจุงุจ ุงููุญุชููุฉ:**
1. โ **ูู ูุชู ุฅูุดุงุก ุญุณุงุจ ุงููุดุฑู ุจุนุฏ** โ ุงุณุชุฎุฏู ุฅุญุฏู ุงูุทุฑู ุงูุซูุงุซ ุฃุนูุงู
2. ูููุฉ ุงููุฑูุฑ ุงููุฏุฎูุฉ ุฎุงุทุฆุฉ
3. ุงุณู ุงููุณุชุฎุฏู ุงููุฏุฎู ุฎุงุทุฆ (ุชุฃูุฏ ูู ุงุณุชุฎุฏุงู `superadmin` ูููุณ email)

### ููู ุชุชุญูู ูู ูุฌูุฏ ุงููุดุฑูุ
**ุงุฐูุจ ุฅูู MongoDB:**
1. ุงูุชุญ MongoDB Atlas
2. ุงุฐูุจ ุฅูู Database โ Browse Collections
3. ุงุจุญุซ ุนู collection ุงุณููุง `admins`
4. ุชุญูู ูู ูุฌูุฏ document ูุน `username: "superadmin"`

**ุฃู ุงุณุชุฎุฏู API endpoint:**
```bash
curl https://sqq-virid.vercel.app/api/setup/init-admin
```
ุณูุนุฑุถ ูู ุนุฏุฏ ุงููุดุฑููู ุงูููุฌูุฏูู.
